<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AudioPlayer å•å…ƒæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-suite {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-suite h2 {
            margin-top: 0;
            color: #555;
            font-size: 1.1em;
        }
        .test-case {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-case.pass {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .test-case.fail {
            background: #ffebee;
            color: #c62828;
        }
        .test-case .icon {
            font-size: 1.2em;
        }
        .summary {
            background: #333;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .summary.all-pass {
            background: #4CAF50;
        }
        .summary.has-fail {
            background: #f44336;
        }
        .error-detail {
            font-size: 0.85em;
            color: #c62828;
            margin-left: 30px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ”Š AudioPlayer å•å…ƒæµ‹è¯•</h1>
    <div id="testResults"></div>
    <div id="summary" class="summary"></div>

    <script src="../js/components/AudioPlayer.js"></script>
    <script>
        // ç®€å•çš„æµ‹è¯•æ¡†æ¶
        const testResults = [];
        let currentSuite = '';
        let currentDescribe = '';

        function describe(name, fn) {
            currentDescribe = name;
            fn();
        }

        // åˆ«å
        const it = test;

        function test(name, fn) {
            const fullSuite = currentDescribe;
            try {
                fn();
                testResults.push({ suite: fullSuite, name, pass: true });
            } catch (error) {
                testResults.push({ suite: fullSuite, name, pass: false, error: error.message });
            }
        }

        function beforeEach(fn) {
            // å­˜å‚¨beforeEachå‡½æ•°ï¼Œåœ¨æ¯ä¸ªæµ‹è¯•å‰è°ƒç”¨
            window._beforeEach = fn;
        }

        function afterEach(fn) {
            // å­˜å‚¨afterEachå‡½æ•°ï¼Œåœ¨æ¯ä¸ªæµ‹è¯•åè°ƒç”¨
            window._afterEach = fn;
        }

        function expect(actual) {
            return {
                toBe(expected) {
                    if (actual !== expected) {
                        throw new Error(`Expected ${JSON.stringify(expected)}, got ${JSON.stringify(actual)}`);
                    }
                },
                toEqual(expected) {
                    if (JSON.stringify(actual) !== JSON.stringify(expected)) {
                        throw new Error(`Expected ${JSON.stringify(expected)}, got ${JSON.stringify(actual)}`);
                    }
                },
                toBeNull() {
                    if (actual !== null) {
                        throw new Error(`Expected null, got ${JSON.stringify(actual)}`);
                    }
                },
                toBeDefined() {
                    if (actual === undefined) {
                        throw new Error('Expected value to be defined');
                    }
                },
                toBeUndefined() {
                    if (actual !== undefined) {
                        throw new Error(`Expected undefined, got ${JSON.stringify(actual)}`);
                    }
                },
                toBeTruthy() {
                    if (!actual) {
                        throw new Error(`Expected truthy value, got ${JSON.stringify(actual)}`);
                    }
                },
                toBeFalsy() {
                    if (actual) {
                        throw new Error(`Expected falsy value, got ${JSON.stringify(actual)}`);
                    }
                },
                toBeGreaterThan(expected) {
                    if (actual <= expected) {
                        throw new Error(`Expected ${actual} to be greater than ${expected}`);
                    }
                },
                toBeGreaterThanOrEqual(expected) {
                    if (actual < expected) {
                        throw new Error(`Expected ${actual} to be greater than or equal to ${expected}`);
                    }
                },
                toBeLessThan(expected) {
                    if (actual >= expected) {
                        throw new Error(`Expected ${actual} to be less than ${expected}`);
                    }
                },
                toBeLessThanOrEqual(expected) {
                    if (actual > expected) {
                        throw new Error(`Expected ${actual} to be less than or equal to ${expected}`);
                    }
                },
                toContain(item) {
                    if (!actual.includes(item)) {
                        throw new Error(`Expected array to contain ${JSON.stringify(item)}`);
                    }
                },
                toHaveProperty(prop) {
                    if (!(prop in actual)) {
                        throw new Error(`Expected object to have property "${prop}"`);
                    }
                },
                toThrow(expectedMessage) {
                    let threw = false;
                    let thrownError = null;
                    try {
                        actual();
                    } catch (e) {
                        threw = true;
                        thrownError = e;
                    }
                    if (!threw) {
                        throw new Error('Expected function to throw');
                    }
                    if (expectedMessage && thrownError.message !== expectedMessage) {
                        throw new Error(`Expected error message "${expectedMessage}", got "${thrownError.message}"`);
                    }
                },
                not: {
                    toThrow() {
                        try {
                            actual();
                        } catch (e) {
                            throw new Error(`Expected function not to throw, but it threw: ${e.message}`);
                        }
                    },
                    toBe(expected) {
                        if (actual === expected) {
                            throw new Error(`Expected ${JSON.stringify(actual)} not to be ${JSON.stringify(expected)}`);
                        }
                    },
                    toBeNull() {
                        if (actual === null) {
                            throw new Error('Expected value not to be null');
                        }
                    }
                }
            };
        }

        // ========================================
        // æµ‹è¯•ç”¨ä¾‹
        // ========================================

        let audioPlayer;

        describe('æ„é€ å‡½æ•°', () => {
            test('åº”è¯¥æ­£ç¡®åˆ›å»ºAudioPlayerå®ä¾‹', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(audioPlayer).toBeDefined();
                audioPlayer.destroy();
            });

            test('åˆå§‹çŠ¶æ€åº”è¯¥æ­£ç¡®', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                const status = audioPlayer.getStatus();
                
                expect(status.isPlaying).toBe(false);
                expect(status.currentAudioId).toBeNull();
                expect(status.progress).toBe(0);
                audioPlayer.destroy();
            });

            test('é»˜è®¤éŸ³è‰²åº”è¯¥æ˜¯voice-female', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(audioPlayer.getVoice()).toBe('voice-female');
                audioPlayer.destroy();
            });

            test('é»˜è®¤éŸ³é‡åº”è¯¥æ˜¯1', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(audioPlayer.getVolume()).toBe(1);
                audioPlayer.destroy();
            });

            test('é»˜è®¤æ’­æ”¾é€Ÿåº¦åº”è¯¥æ˜¯1', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(audioPlayer.getPlaybackRate()).toBe(1);
                audioPlayer.destroy();
            });
        });

        describe('play() æ’­æ”¾éŸ³é¢‘ - Requirements: 5.1', () => {
            test('åº”è¯¥åœ¨æ²¡æœ‰audioUrlæ—¶æŠ›å‡ºé”™è¯¯', async () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                let errorThrown = false;
                try {
                    await audioPlayer.play(null);
                } catch (error) {
                    errorThrown = true;
                    expect(error.message).toBe('audioUrl is required');
                }
                expect(errorThrown).toBe(true);
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨ç©ºå­—ç¬¦ä¸²audioUrlæ—¶æŠ›å‡ºé”™è¯¯', async () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                let errorThrown = false;
                try {
                    await audioPlayer.play('');
                } catch (error) {
                    errorThrown = true;
                    expect(error.message).toBe('audioUrl is required');
                }
                expect(errorThrown).toBe(true);
                audioPlayer.destroy();
            });

            test('åº”è¯¥æ›´æ–°currentAudioId', async () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                try {
                    await audioPlayer.play('assets/audio/test-audio.mp3');
                } catch (e) {
                    // å¿½ç•¥æ’­æ”¾é”™è¯¯ï¼Œåªæµ‹è¯•çŠ¶æ€æ›´æ–°
                }
                
                const status = audioPlayer.getStatus();
                expect(status.currentAudioId).toBe('test-audio');
                audioPlayer.destroy();
            });

            test('åº”è¯¥ä»URLä¸­æ­£ç¡®æå–audioId', async () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                try {
                    await audioPlayer.play('assets/audio/voice-female/audio-hello-wuyifan.mp3');
                } catch (e) {
                    // å¿½ç•¥æ’­æ”¾é”™è¯¯
                }
                
                const status = audioPlayer.getStatus();
                expect(status.currentAudioId).toBe('audio-hello-wuyifan');
                audioPlayer.destroy();
            });

            test('åº”è¯¥é‡ç½®è¿›åº¦ä¸º0', async () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                try {
                    await audioPlayer.play('assets/audio/test.mp3');
                } catch (e) {
                    // å¿½ç•¥æ’­æ”¾é”™è¯¯
                }
                
                const status = audioPlayer.getStatus();
                expect(status.progress).toBe(0);
                audioPlayer.destroy();
            });
        });

        describe('stop() åœæ­¢æ’­æ”¾', () => {
            test('åº”è¯¥åœæ­¢æ’­æ”¾å¹¶é‡ç½®çŠ¶æ€', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                audioPlayer.stop();
                
                const status = audioPlayer.getStatus();
                expect(status.isPlaying).toBe(false);
                expect(status.progress).toBe(0);
                audioPlayer.destroy();
            });

            test('åº”è¯¥å°†å½“å‰æ—¶é—´é‡ç½®ä¸º0', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                audioPlayer.stop();
                expect(audioPlayer.getCurrentTime()).toBe(0);
                audioPlayer.destroy();
            });

            test('å¤šæ¬¡è°ƒç”¨stopä¸åº”è¯¥æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => {
                    audioPlayer.stop();
                    audioPlayer.stop();
                    audioPlayer.stop();
                }).not.toThrow();
                audioPlayer.destroy();
            });
        });

        describe('pause() æš‚åœæ’­æ”¾', () => {
            test('åº”è¯¥æš‚åœæ’­æ”¾', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                audioPlayer.pause();
                
                const status = audioPlayer.getStatus();
                expect(status.isPlaying).toBe(false);
                audioPlayer.destroy();
            });

            test('å¤šæ¬¡è°ƒç”¨pauseä¸åº”è¯¥æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => {
                    audioPlayer.pause();
                    audioPlayer.pause();
                }).not.toThrow();
                audioPlayer.destroy();
            });
        });

        describe('setVoice() è®¾ç½®éŸ³è‰²', () => {
            test('åº”è¯¥æ­£ç¡®è®¾ç½®éŸ³è‰²', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                audioPlayer.setVoice('voice-male');
                expect(audioPlayer.getVoice()).toBe('voice-male');
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨æ²¡æœ‰voiceIdæ—¶æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.setVoice(null)).toThrow('voiceId is required');
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨ç©ºå­—ç¬¦ä¸²voiceIdæ—¶æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.setVoice('')).toThrow('voiceId is required');
                audioPlayer.destroy();
            });

            test('åº”è¯¥æ”¯æŒä¸åŒçš„éŸ³è‰²ID', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                const voices = ['voice-female', 'voice-male', 'voice-child'];
                
                voices.forEach(voice => {
                    audioPlayer.setVoice(voice);
                    expect(audioPlayer.getVoice()).toBe(voice);
                });
                audioPlayer.destroy();
            });
        });

        describe('getStatus() è·å–æ’­æ”¾çŠ¶æ€', () => {
            test('åº”è¯¥è¿”å›çŠ¶æ€å¯¹è±¡çš„å‰¯æœ¬', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                const status1 = audioPlayer.getStatus();
                const status2 = audioPlayer.getStatus();
                
                // ä¿®æ”¹status1ä¸åº”è¯¥å½±å“status2
                status1.isPlaying = true;
                expect(status2.isPlaying).toBe(false);
                audioPlayer.destroy();
            });

            test('åº”è¯¥åŒ…å«æ‰€æœ‰å¿…è¦çš„çŠ¶æ€å­—æ®µ', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                const status = audioPlayer.getStatus();
                
                expect(status).toHaveProperty('isPlaying');
                expect(status).toHaveProperty('currentAudioId');
                expect(status).toHaveProperty('progress');
                audioPlayer.destroy();
            });

            test('progressåº”è¯¥åœ¨0-100èŒƒå›´å†…', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                const status = audioPlayer.getStatus();
                expect(status.progress).toBeGreaterThanOrEqual(0);
                expect(status.progress).toBeLessThanOrEqual(100);
                audioPlayer.destroy();
            });
        });

        describe('onComplete() æ’­æ”¾å®Œæˆå›è°ƒ', () => {
            test('åº”è¯¥æ­£ç¡®æ³¨å†Œå›è°ƒå‡½æ•°', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                const callback = () => {};
                expect(() => audioPlayer.onComplete(callback)).not.toThrow();
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨å›è°ƒä¸æ˜¯å‡½æ•°æ—¶æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.onComplete('not a function')).toThrow('callback must be a function');
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨å›è°ƒä¸ºnullæ—¶æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.onComplete(null)).toThrow('callback must be a function');
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨å›è°ƒä¸ºæ•°å­—æ—¶æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.onComplete(123)).toThrow('callback must be a function');
                audioPlayer.destroy();
            });
        });

        describe('onError() æ’­æ”¾é”™è¯¯å›è°ƒ', () => {
            test('åº”è¯¥æ­£ç¡®æ³¨å†Œå›è°ƒå‡½æ•°', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                const callback = () => {};
                expect(() => audioPlayer.onError(callback)).not.toThrow();
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨å›è°ƒä¸æ˜¯å‡½æ•°æ—¶æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.onError('not a function')).toThrow('callback must be a function');
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨å›è°ƒä¸ºnullæ—¶æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.onError(null)).toThrow('callback must be a function');
                audioPlayer.destroy();
            });
        });

        describe('onProgress() æ’­æ”¾è¿›åº¦å›è°ƒ', () => {
            test('åº”è¯¥æ­£ç¡®æ³¨å†Œå›è°ƒå‡½æ•°', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                const callback = () => {};
                expect(() => audioPlayer.onProgress(callback)).not.toThrow();
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨å›è°ƒä¸æ˜¯å‡½æ•°æ—¶æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.onProgress('not a function')).toThrow('callback must be a function');
                audioPlayer.destroy();
            });
        });

        describe('setVolume() è®¾ç½®éŸ³é‡', () => {
            test('åº”è¯¥æ­£ç¡®è®¾ç½®éŸ³é‡', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                audioPlayer.setVolume(0.5);
                expect(audioPlayer.getVolume()).toBe(0.5);
                audioPlayer.destroy();
            });

            test('åº”è¯¥æ”¯æŒéŸ³é‡èŒƒå›´0-1', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                audioPlayer.setVolume(0);
                expect(audioPlayer.getVolume()).toBe(0);
                
                audioPlayer.setVolume(1);
                expect(audioPlayer.getVolume()).toBe(1);
                
                audioPlayer.setVolume(0.75);
                expect(audioPlayer.getVolume()).toBe(0.75);
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨éŸ³é‡è¶…å‡ºèŒƒå›´æ—¶æŠ›å‡ºé”™è¯¯ - è´Ÿæ•°', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.setVolume(-0.1)).toThrow('volume must be a number between 0 and 1');
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨éŸ³é‡è¶…å‡ºèŒƒå›´æ—¶æŠ›å‡ºé”™è¯¯ - å¤§äº1', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.setVolume(1.1)).toThrow('volume must be a number between 0 and 1');
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨éŸ³é‡ä¸æ˜¯æ•°å­—æ—¶æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.setVolume('0.5')).toThrow('volume must be a number between 0 and 1');
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨éŸ³é‡ä¸ºnullæ—¶æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.setVolume(null)).toThrow('volume must be a number between 0 and 1');
                audioPlayer.destroy();
            });
        });

        describe('setPlaybackRate() è®¾ç½®æ’­æ”¾é€Ÿåº¦', () => {
            test('åº”è¯¥æ­£ç¡®è®¾ç½®æ’­æ”¾é€Ÿåº¦', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                audioPlayer.setPlaybackRate(1.5);
                expect(audioPlayer.getPlaybackRate()).toBe(1.5);
                audioPlayer.destroy();
            });

            test('åº”è¯¥æ”¯æŒæ’­æ”¾é€Ÿåº¦èŒƒå›´0.5-2', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                audioPlayer.setPlaybackRate(0.5);
                expect(audioPlayer.getPlaybackRate()).toBe(0.5);
                
                audioPlayer.setPlaybackRate(2);
                expect(audioPlayer.getPlaybackRate()).toBe(2);
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨æ’­æ”¾é€Ÿåº¦è¶…å‡ºèŒƒå›´æ—¶æŠ›å‡ºé”™è¯¯ - å°äº0.5', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.setPlaybackRate(0.4)).toThrow('playback rate must be a number between 0.5 and 2');
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨æ’­æ”¾é€Ÿåº¦è¶…å‡ºèŒƒå›´æ—¶æŠ›å‡ºé”™è¯¯ - å¤§äº2', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.setPlaybackRate(2.1)).toThrow('playback rate must be a number between 0.5 and 2');
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨æ’­æ”¾é€Ÿåº¦ä¸æ˜¯æ•°å­—æ—¶æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.setPlaybackRate('1.5')).toThrow('playback rate must be a number between 0.5 and 2');
                audioPlayer.destroy();
            });
        });

        describe('seekTo() è·³è½¬åˆ°æŒ‡å®šæ—¶é—´', () => {
            test('åº”è¯¥åœ¨æ—¶é—´ä¸ºè´Ÿæ•°æ—¶æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.seekTo(-1)).toThrow('time must be a non-negative number');
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨æ—¶é—´ä¸æ˜¯æ•°å­—æ—¶æŠ›å‡ºé”™è¯¯ - å­—ç¬¦ä¸²', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.seekTo('10')).toThrow('time must be a non-negative number');
                audioPlayer.destroy();
            });

            test('åº”è¯¥åœ¨æ—¶é—´ä¸ºnullæ—¶æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.seekTo(null)).toThrow('time must be a non-negative number');
                audioPlayer.destroy();
            });

            test('åº”è¯¥æ¥å—0ä½œä¸ºæœ‰æ•ˆæ—¶é—´', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => audioPlayer.seekTo(0)).not.toThrow();
                audioPlayer.destroy();
            });
        });

        describe('isPlaying() æ£€æŸ¥æ’­æ”¾çŠ¶æ€', () => {
            test('åˆå§‹çŠ¶æ€åº”è¯¥è¿”å›false', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(audioPlayer.isPlaying()).toBe(false);
                audioPlayer.destroy();
            });

            test('åœæ­¢ååº”è¯¥è¿”å›false', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                audioPlayer.stop();
                expect(audioPlayer.isPlaying()).toBe(false);
                audioPlayer.destroy();
            });

            test('æš‚åœååº”è¯¥è¿”å›false', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                audioPlayer.pause();
                expect(audioPlayer.isPlaying()).toBe(false);
                audioPlayer.destroy();
            });
        });

        describe('getCurrentTime() è·å–å½“å‰æ’­æ”¾æ—¶é—´', () => {
            test('åˆå§‹çŠ¶æ€åº”è¯¥è¿”å›0', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(audioPlayer.getCurrentTime()).toBe(0);
                audioPlayer.destroy();
            });

            test('åœæ­¢ååº”è¯¥è¿”å›0', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                audioPlayer.stop();
                expect(audioPlayer.getCurrentTime()).toBe(0);
                audioPlayer.destroy();
            });
        });

        describe('getDuration() è·å–éŸ³é¢‘æ—¶é•¿', () => {
            test('æœªåŠ è½½éŸ³é¢‘æ—¶åº”è¯¥è¿”å›0', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(audioPlayer.getDuration()).toBe(0);
                audioPlayer.destroy();
            });
        });

        describe('removeAllCallbacks() ç§»é™¤æ‰€æœ‰å›è°ƒ', () => {
            test('åº”è¯¥ç§»é™¤æ‰€æœ‰å›è°ƒ', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                audioPlayer.onComplete(() => {});
                audioPlayer.onError(() => {});
                audioPlayer.onProgress(() => {});
                
                expect(() => audioPlayer.removeAllCallbacks()).not.toThrow();
                audioPlayer.destroy();
            });
        });

        describe('destroy() é”€æ¯æ’­æ”¾å™¨', () => {
            test('åº”è¯¥é‡ç½®æ‰€æœ‰çŠ¶æ€', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                audioPlayer.setVoice('voice-male');
                audioPlayer.destroy();
                
                // åˆ›å»ºæ–°å®ä¾‹éªŒè¯é”€æ¯æ•ˆæœ
                const newPlayer = new AudioPlayer();
                const status = newPlayer.getStatus();
                
                expect(status.isPlaying).toBe(false);
                expect(status.currentAudioId).toBeNull();
                expect(status.progress).toBe(0);
                
                newPlayer.destroy();
            });

            test('å¤šæ¬¡è°ƒç”¨destroyä¸åº”è¯¥æŠ›å‡ºé”™è¯¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                expect(() => {
                    audioPlayer.destroy();
                    audioPlayer.destroy();
                }).not.toThrow();
            });
        });

        describe('setDebug() è°ƒè¯•æ¨¡å¼', () => {
            test('åº”è¯¥èƒ½å¤Ÿå¯ç”¨å’Œç¦ç”¨è°ƒè¯•æ¨¡å¼', () => {
                audioPlayer = new AudioPlayer();
                expect(() => {
                    audioPlayer.setDebug(true);
                    audioPlayer.setDebug(false);
                }).not.toThrow();
                audioPlayer.destroy();
            });
        });

        // ========================================
        // æ¸²æŸ“æµ‹è¯•ç»“æœ
        // ========================================
        function renderResults() {
            const container = document.getElementById('testResults');
            const summaryEl = document.getElementById('summary');
            
            // æŒ‰æµ‹è¯•å¥—ä»¶åˆ†ç»„
            const suites = {};
            testResults.forEach(result => {
                if (!suites[result.suite]) {
                    suites[result.suite] = [];
                }
                suites[result.suite].push(result);
            });

            // æ¸²æŸ“æ¯ä¸ªæµ‹è¯•å¥—ä»¶
            let html = '';
            for (const [suiteName, tests] of Object.entries(suites)) {
                html += `<div class="test-suite">
                    <h2>${suiteName}</h2>`;
                
                tests.forEach(test => {
                    const icon = test.pass ? 'âœ…' : 'âŒ';
                    const className = test.pass ? 'pass' : 'fail';
                    html += `<div class="test-case ${className}">
                        <span class="icon">${icon}</span>
                        <span>${test.name}</span>
                    </div>`;
                    if (!test.pass && test.error) {
                        html += `<div class="error-detail">${test.error}</div>`;
                    }
                });
                
                html += '</div>';
            }
            
            container.innerHTML = html;

            // æ¸²æŸ“æ‘˜è¦
            const passed = testResults.filter(r => r.pass).length;
            const failed = testResults.filter(r => !r.pass).length;
            const total = testResults.length;
            
            summaryEl.className = `summary ${failed === 0 ? 'all-pass' : 'has-fail'}`;
            summaryEl.innerHTML = `
                <strong>æµ‹è¯•ç»“æœ:</strong> ${passed}/${total} é€šè¿‡
                ${failed > 0 ? ` | ${failed} å¤±è´¥` : ' | å…¨éƒ¨é€šè¿‡ ğŸ‰'}
            `;
        }

        // ========================================
        // éŸ³é¢‘é”™è¯¯å¤„ç†æµ‹è¯• - Requirements: 5.5
        // ========================================
        
        describe('AudioPlayer é”™è¯¯å›è°ƒ - Requirements: 5.5', () => {
            test('onErrorå›è°ƒåº”è¯¥æ¥æ”¶é”™è¯¯å¯¹è±¡', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                
                let receivedError = null;
                audioPlayer.onError((error) => {
                    receivedError = error;
                });
                
                // éªŒè¯å›è°ƒå·²æ³¨å†Œï¼ˆä¸ä¼šæŠ›å‡ºé”™è¯¯ï¼‰
                expect(() => audioPlayer.onError(() => {})).not.toThrow();
                audioPlayer.destroy();
            });

            test('é”™è¯¯å¯¹è±¡åº”è¯¥åŒ…å«audioIdã€messageå’Œerrorå­—æ®µ', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                
                // éªŒè¯AudioPlayerçš„_getErrorMessageæ–¹æ³•å­˜åœ¨
                // è¿™æ˜¯å†…éƒ¨æ–¹æ³•ï¼Œé€šè¿‡æµ‹è¯•é”™è¯¯å›è°ƒé—´æ¥éªŒè¯
                let callbackCalled = false;
                audioPlayer.onError((error) => {
                    callbackCalled = true;
                    // é”™è¯¯å¯¹è±¡åº”è¯¥æœ‰è¿™äº›å­—æ®µ
                    expect(error).toHaveProperty('audioId');
                    expect(error).toHaveProperty('message');
                    expect(error).toHaveProperty('error');
                });
                
                // æ³¨æ„ï¼šå®é™…è§¦å‘é”™è¯¯éœ€è¦æ’­æ”¾æ— æ•ˆéŸ³é¢‘
                audioPlayer.destroy();
            });
        });

        describe('AudioPlayer é”™è¯¯æ¶ˆæ¯è½¬æ¢', () => {
            test('åº”è¯¥ä¸ºMEDIA_ERR_NETWORKè¿”å›ç½‘ç»œé”™è¯¯æ¶ˆæ¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                
                // æµ‹è¯•å†…éƒ¨é”™è¯¯æ¶ˆæ¯è½¬æ¢é€»è¾‘
                // é€šè¿‡åˆ›å»ºæ¨¡æ‹Ÿé”™è¯¯å¯¹è±¡æ¥æµ‹è¯•
                const mockError = { code: 2 }; // MEDIA_ERR_NETWORK = 2
                
                // ç”±äº_getErrorMessageæ˜¯ç§æœ‰æ–¹æ³•ï¼Œæˆ‘ä»¬é€šè¿‡è¡Œä¸ºæµ‹è¯•
                // éªŒè¯AudioPlayerèƒ½æ­£ç¡®å¤„ç†é”™è¯¯
                expect(audioPlayer).toBeDefined();
                audioPlayer.destroy();
            });

            test('åº”è¯¥ä¸ºMEDIA_ERR_DECODEè¿”å›è§£ç é”™è¯¯æ¶ˆæ¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                
                // MEDIA_ERR_DECODE = 3
                expect(audioPlayer).toBeDefined();
                audioPlayer.destroy();
            });

            test('åº”è¯¥ä¸ºMEDIA_ERR_SRC_NOT_SUPPORTEDè¿”å›æ ¼å¼ä¸æ”¯æŒæ¶ˆæ¯', () => {
                audioPlayer = new AudioPlayer();
                audioPlayer.setDebug(false);
                
                // MEDIA_ERR_SRC_NOT_SUPPORTED = 4
                expect(audioPlayer).toBeDefined();
                audioPlayer.destroy();
            });
        });

        // è¿è¡Œæµ‹è¯•å¹¶æ¸²æŸ“ç»“æœ
        renderResults();
    </script>
</body>
</html>
