<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TextbookSelector æµ‹è¯•</title>
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/main.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-suite {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-suite h2 {
            margin-top: 0;
            color: #555;
            font-size: 1.1em;
        }
        .test-case {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-case.pass {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .test-case.fail {
            background: #ffebee;
            color: #c62828;
        }
        .test-case .icon {
            font-size: 1.2em;
        }
        .summary {
            background: #333;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .summary.all-pass {
            background: #4CAF50;
        }
        .summary.has-fail {
            background: #f44336;
        }
        .error-detail {
            font-size: 0.85em;
            color: #c62828;
            margin-left: 30px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        #test-container {
            display: none;
        }
    </style>
</head>
<body>
    <h1>ğŸ“– TextbookSelector å•å…ƒæµ‹è¯•</h1>
    <div id="testResults"></div>
    <div id="summary" class="summary"></div>
    
    <!-- æµ‹è¯•ç”¨çš„éšè—å®¹å™¨ -->
    <div id="test-container"></div>

    <!-- åŠ è½½ä¾èµ– -->
    <script src="../js/data/DataManager.js"></script>
    <script src="../js/components/TextbookSelector.js"></script>
    
    <script>
        // ç®€å•çš„æµ‹è¯•æ¡†æ¶
        const testResults = [];
        let currentSuite = '';
        let beforeEachFn = null;
        let afterEachFn = null;

        function describe(name, fn) {
            currentSuite = name;
            beforeEachFn = null;
            afterEachFn = null;
            fn();
        }

        function beforeEach(fn) {
            beforeEachFn = fn;
        }

        function afterEach(fn) {
            afterEachFn = fn;
        }

        function it(name, fn) {
            try {
                if (beforeEachFn) beforeEachFn();
                fn();
                testResults.push({ suite: currentSuite, name, pass: true });
            } catch (error) {
                testResults.push({ suite: currentSuite, name, pass: false, error: error.message + '\n' + error.stack });
            } finally {
                if (afterEachFn) afterEachFn();
            }
        }

        // å¼‚æ­¥æµ‹è¯•æ”¯æŒ
        async function itAsync(name, fn) {
            try {
                if (beforeEachFn) beforeEachFn();
                await fn();
                testResults.push({ suite: currentSuite, name, pass: true });
            } catch (error) {
                testResults.push({ suite: currentSuite, name, pass: false, error: error.message + '\n' + error.stack });
            } finally {
                if (afterEachFn) afterEachFn();
            }
        }

        const expect = (actual) => ({
            to: {
                be: {
                    an: {
                        instanceof: (expected) => {
                            if (!(actual instanceof expected)) {
                                throw new Error(`Expected instance of ${expected.name}, got ${actual?.constructor?.name}`);
                            }
                        },
                        array: () => {
                            if (!Array.isArray(actual)) {
                                throw new Error(`Expected array, got ${typeof actual}`);
                            }
                        }
                    },
                    null: () => {
                        if (actual !== null) {
                            throw new Error(`Expected null, got ${JSON.stringify(actual)}`);
                        }
                    },
                    true: () => {
                        if (actual !== true) {
                            throw new Error(`Expected true, got ${actual}`);
                        }
                    },
                    false: () => {
                        if (actual !== false) {
                            throw new Error(`Expected false, got ${actual}`);
                        }
                    }
                },
                equal: (expected) => {
                    if (actual !== expected) {
                        throw new Error(`Expected ${JSON.stringify(expected)}, got ${JSON.stringify(actual)}`);
                    }
                },
                deep: {
                    equal: (expected) => {
                        if (JSON.stringify(actual) !== JSON.stringify(expected)) {
                            throw new Error(`Expected ${JSON.stringify(expected)}, got ${JSON.stringify(actual)}`);
                        }
                    }
                },
                not: {
                    be: {
                        null: () => {
                            if (actual === null) {
                                throw new Error('Expected not null, got null');
                            }
                        }
                    }
                },
                include: (expected) => {
                    if (typeof actual === 'string') {
                        if (!actual.includes(expected)) {
                            throw new Error(`Expected "${actual}" to include "${expected}"`);
                        }
                    }
                },
                throw: (expectedMessage) => {
                    let threw = false;
                    let errorMessage = '';
                    try {
                        actual();
                    } catch (e) {
                        threw = true;
                        errorMessage = e.message;
                    }
                    if (!threw) {
                        throw new Error('Expected function to throw');
                    }
                    if (expectedMessage && errorMessage !== expectedMessage) {
                        throw new Error(`Expected error "${expectedMessage}", got "${errorMessage}"`);
                    }
                }
            },
            fail: (message) => {
                throw new Error(message || 'Test failed');
            }
        });

        // æ¨¡æ‹Ÿæ•™ææ•°æ®
        const mockTextbooks = [
            {
                id: 'english-pep-3-1',
                subjectId: 'english',
                name: 'PEPè‹±è¯­ä¸‰å¹´çº§ä¸Šå†Œ',
                publisher: 'äººæ°‘æ•™è‚²å‡ºç‰ˆç¤¾',
                grade: 3,
                semester: 'ä¸Š',
                coverImage: 'assets/images/covers/english-pep-3-1.png',
                totalChapters: 6
            },
            {
                id: 'english-pep-3-2',
                subjectId: 'english',
                name: 'PEPè‹±è¯­ä¸‰å¹´çº§ä¸‹å†Œ',
                publisher: 'äººæ°‘æ•™è‚²å‡ºç‰ˆç¤¾',
                grade: 3,
                semester: 'ä¸‹',
                coverImage: 'assets/images/covers/english-pep-3-2.png',
                totalChapters: 6
            },
            {
                id: 'english-pep-4-1',
                subjectId: 'english',
                name: 'PEPè‹±è¯­å››å¹´çº§ä¸Šå†Œ',
                publisher: 'äººæ°‘æ•™è‚²å‡ºç‰ˆç¤¾',
                grade: 4,
                semester: 'ä¸Š',
                coverImage: 'assets/images/covers/english-pep-4-1.png',
                totalChapters: 6
            }
        ];

        let container;
        let selector;
        let mockDataManager;

        // ========================================
        // æµ‹è¯•ç”¨ä¾‹
        // ========================================

        describe('æ„é€ å‡½æ•°', () => {
            beforeEach(() => {
                container = document.getElementById('test-container');
                container.innerHTML = '';
            });

            it('åº”è¯¥æ­£ç¡®åˆ›å»ºå®ä¾‹', () => {
                selector = new TextbookSelector(container);
                expect(selector).to.be.an.instanceof(TextbookSelector);
                selector.destroy();
            });

            it('åº”è¯¥åœ¨æ²¡æœ‰å®¹å™¨æ—¶æŠ›å‡ºé”™è¯¯', () => {
                expect(() => {
                    new TextbookSelector(null);
                }).to.throw('TextbookSelector requires a valid HTMLElement container');
            });

            it('åº”è¯¥åœ¨å®¹å™¨ä¸æ˜¯HTMLElementæ—¶æŠ›å‡ºé”™è¯¯', () => {
                expect(() => {
                    new TextbookSelector('not-an-element');
                }).to.throw('TextbookSelector requires a valid HTMLElement container');
            });
        });

        describe('loadTextbooks', () => {
            beforeEach(() => {
                container = document.getElementById('test-container');
                container.innerHTML = '';
                mockDataManager = {
                    getTextbooks: (subjectId) => Promise.resolve(mockTextbooks.filter(t => t.subjectId === subjectId))
                };
                selector = new TextbookSelector(container);
                selector.setDataManager(mockDataManager);
                selector.setDebug(false);
            });

            afterEach(() => {
                if (selector) selector.destroy();
            });

            itAsync('åº”è¯¥æˆåŠŸåŠ è½½æ•™æåˆ—è¡¨', async () => {
                const textbooks = await selector.loadTextbooks('english');
                expect(textbooks).to.be.an.array();
                expect(textbooks.length).to.equal(3);
            });

            itAsync('åº”è¯¥è®°å½•å½“å‰å­¦ç§‘ID', async () => {
                await selector.loadTextbooks('english');
                expect(selector.getCurrentSubjectId()).to.equal('english');
            });
        });

        describe('render', () => {
            beforeEach(() => {
                container = document.getElementById('test-container');
                container.innerHTML = '';
                selector = new TextbookSelector(container);
                selector.setDebug(false);
            });

            afterEach(() => {
                if (selector) selector.destroy();
            });

            it('åº”è¯¥æ­£ç¡®æ¸²æŸ“æ•™æåˆ—è¡¨', () => {
                selector.render(mockTextbooks);
                const cards = container.querySelectorAll('.card-textbook');
                expect(cards.length).to.equal(3);
            });

            it('åº”è¯¥æ˜¾ç¤ºæ•™ææ ‡é¢˜', () => {
                selector.render(mockTextbooks);
                const titles = container.querySelectorAll('.card-textbook-title');
                expect(titles[0].textContent).to.equal('PEPè‹±è¯­ä¸‰å¹´çº§ä¸Šå†Œ');
            });

            it('åº”è¯¥æ˜¾ç¤ºå‡ºç‰ˆç¤¾ä¿¡æ¯', () => {
                selector.render(mockTextbooks);
                const publishers = container.querySelectorAll('.card-textbook-publisher');
                expect(publishers[0].textContent).to.equal('äººæ°‘æ•™è‚²å‡ºç‰ˆç¤¾');
            });

            it('åº”è¯¥æ˜¾ç¤ºå¹´çº§å’Œå­¦æœŸä¿¡æ¯', () => {
                selector.render(mockTextbooks);
                const grades = container.querySelectorAll('.textbook-grade');
                const semesters = container.querySelectorAll('.textbook-semester');
                expect(grades[0].textContent).to.include('3å¹´çº§');
                expect(semesters[0].textContent).to.include('ä¸Šå­¦æœŸ');
            });

            it('åº”è¯¥åœ¨æ•™æåˆ—è¡¨ä¸ºç©ºæ—¶æ˜¾ç¤ºç©ºçŠ¶æ€', () => {
                selector.render([]);
                const emptyState = container.querySelector('.textbook-empty-state');
                expect(emptyState).to.not.be.null();
            });

            it('åº”è¯¥åœ¨ç©ºçŠ¶æ€æ—¶æ˜¾ç¤ºå‹å¥½æç¤º', () => {
                selector.render([]);
                const emptyTitle = container.querySelector('.empty-title');
                expect(emptyTitle.textContent).to.equal('å†…å®¹å³å°†ä¸Šçº¿');
            });

            it('åº”è¯¥åœ¨textbooksä¸æ˜¯æ•°ç»„æ—¶æŠ›å‡ºé”™è¯¯', () => {
                expect(() => {
                    selector.render('not-an-array');
                }).to.throw('textbooks must be an array');
            });

            it('åº”è¯¥åˆ›å»ºé¡µé¢æ ‡é¢˜', () => {
                selector.render(mockTextbooks);
                const title = container.querySelector('.textbook-selector-title');
                expect(title).to.not.be.null();
                expect(title.textContent).to.include('é€‰æ‹©æ•™æ');
            });
        });

        describe('selectTextbook', () => {
            beforeEach(() => {
                container = document.getElementById('test-container');
                container.innerHTML = '';
                selector = new TextbookSelector(container);
                selector.setDebug(false);
                selector.render(mockTextbooks);
            });

            afterEach(() => {
                if (selector) selector.destroy();
            });

            it('åº”è¯¥æ­£ç¡®é€‰æ‹©æ•™æ', () => {
                selector.selectTextbook('english-pep-3-1');
                const selected = selector.getSelectedTextbook();
                expect(selected).to.not.be.null();
                expect(selected.id).to.equal('english-pep-3-1');
            });

            it('åº”è¯¥é«˜äº®æ˜¾ç¤ºé€‰ä¸­çš„æ•™æ', () => {
                selector.selectTextbook('english-pep-3-1');
                const selectedCard = container.querySelector('[data-textbook-id="english-pep-3-1"]');
                expect(selectedCard.classList.contains('selected')).to.be.true();
            });

            it('åº”è¯¥è®¾ç½®aria-selectedå±æ€§', () => {
                selector.selectTextbook('english-pep-3-1');
                const selectedCard = container.querySelector('[data-textbook-id="english-pep-3-1"]');
                expect(selectedCard.getAttribute('aria-selected')).to.equal('true');
            });

            it('åº”è¯¥ç§»é™¤å…¶ä»–æ•™æçš„é€‰ä¸­çŠ¶æ€', () => {
                selector.selectTextbook('english-pep-3-1');
                selector.selectTextbook('english-pep-3-2');
                const firstCard = container.querySelector('[data-textbook-id="english-pep-3-1"]');
                const secondCard = container.querySelector('[data-textbook-id="english-pep-3-2"]');
                expect(firstCard.classList.contains('selected')).to.be.false();
                expect(secondCard.classList.contains('selected')).to.be.true();
            });

            it('åº”è¯¥è§¦å‘é€‰æ‹©å›è°ƒ', () => {
                let callbackCalled = false;
                let selectedTextbook = null;
                selector.onSelect((textbook) => {
                    callbackCalled = true;
                    selectedTextbook = textbook;
                });
                selector.selectTextbook('english-pep-3-1');
                expect(callbackCalled).to.be.true();
                expect(selectedTextbook.id).to.equal('english-pep-3-1');
            });
        });

        describe('getSelectedTextbook', () => {
            beforeEach(() => {
                container = document.getElementById('test-container');
                container.innerHTML = '';
                selector = new TextbookSelector(container);
                selector.setDebug(false);
                selector.render(mockTextbooks);
            });

            afterEach(() => {
                if (selector) selector.destroy();
            });

            it('åº”è¯¥åœ¨æœªé€‰æ‹©æ—¶è¿”å›null', () => {
                const selected = selector.getSelectedTextbook();
                expect(selected).to.be.null();
            });

            it('åº”è¯¥è¿”å›é€‰ä¸­çš„æ•™æå¯¹è±¡', () => {
                selector.selectTextbook('english-pep-3-1');
                const selected = selector.getSelectedTextbook();
                expect(selected).to.deep.equal(mockTextbooks[0]);
            });
        });

        describe('showLoading', () => {
            beforeEach(() => {
                container = document.getElementById('test-container');
                container.innerHTML = '';
                selector = new TextbookSelector(container);
                selector.setDebug(false);
            });

            afterEach(() => {
                if (selector) selector.destroy();
            });

            it('åº”è¯¥æ˜¾ç¤ºåŠ è½½åŠ¨ç”»', () => {
                selector.showLoading();
                const loadingContainer = container.querySelector('.loading-container');
                expect(loadingContainer).to.not.be.null();
            });

            it('åº”è¯¥æ˜¾ç¤ºåŠ è½½æ–‡æœ¬', () => {
                selector.showLoading();
                const loadingText = container.querySelector('.loading-text');
                expect(loadingText.textContent).to.include('æ­£åœ¨åŠ è½½æ•™æ');
            });

            it('åº”è¯¥æ˜¾ç¤ºå¯çˆ±çš„ä¹¦æœ¬åŠ¨ç”»', () => {
                selector.showLoading();
                const bookAnimation = container.querySelector('.loading-book-animation');
                expect(bookAnimation).to.not.be.null();
            });

            it('åº”è¯¥æ˜¾ç¤ºè·³åŠ¨çš„ç‚¹ç‚¹', () => {
                selector.showLoading();
                const loadingDots = container.querySelector('.loading-dots');
                expect(loadingDots).to.not.be.null();
            });

            it('åº”è¯¥è®¾ç½®isLoadingä¸ºtrue', () => {
                selector.showLoading();
                expect(selector.isLoading()).to.be.true();
            });
        });

        describe('hideLoading', () => {
            beforeEach(() => {
                container = document.getElementById('test-container');
                container.innerHTML = '';
                selector = new TextbookSelector(container);
                selector.setDebug(false);
            });

            afterEach(() => {
                if (selector) selector.destroy();
            });

            it('åº”è¯¥è®¾ç½®isLoadingä¸ºfalse', () => {
                selector.showLoading();
                selector.hideLoading();
                expect(selector.isLoading()).to.be.false();
            });
        });

        describe('clearSelection', () => {
            beforeEach(() => {
                container = document.getElementById('test-container');
                container.innerHTML = '';
                selector = new TextbookSelector(container);
                selector.setDebug(false);
                selector.render(mockTextbooks);
            });

            afterEach(() => {
                if (selector) selector.destroy();
            });

            it('åº”è¯¥æ¸…é™¤é€‰ä¸­çŠ¶æ€', () => {
                selector.selectTextbook('english-pep-3-1');
                selector.clearSelection();
                const selected = selector.getSelectedTextbook();
                expect(selected).to.be.null();
            });

            it('åº”è¯¥ç§»é™¤æ‰€æœ‰å¡ç‰‡çš„é€‰ä¸­æ ·å¼', () => {
                selector.selectTextbook('english-pep-3-1');
                selector.clearSelection();
                const selectedCards = container.querySelectorAll('.card-textbook.selected');
                expect(selectedCards.length).to.equal(0);
            });
        });

        describe('showError', () => {
            beforeEach(() => {
                container = document.getElementById('test-container');
                container.innerHTML = '';
                selector = new TextbookSelector(container);
                selector.setDebug(false);
            });

            afterEach(() => {
                if (selector) selector.destroy();
            });

            it('åº”è¯¥æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯', () => {
                selector.showError('æµ‹è¯•é”™è¯¯');
                const errorMessage = container.querySelector('.error-message');
                expect(errorMessage.textContent).to.equal('æµ‹è¯•é”™è¯¯');
            });

            it('åº”è¯¥æ˜¾ç¤ºé‡è¯•æŒ‰é’®', () => {
                selector.showError('æµ‹è¯•é”™è¯¯');
                const retryBtn = container.querySelector('.retry-btn');
                expect(retryBtn).to.not.be.null();
            });

            it('åº”è¯¥åœ¨ç‚¹å‡»é‡è¯•æŒ‰é’®æ—¶è§¦å‘å›è°ƒ', () => {
                let retryCalled = false;
                selector.showError('æµ‹è¯•é”™è¯¯', () => {
                    retryCalled = true;
                });
                const retryBtn = container.querySelector('.retry-btn');
                retryBtn.click();
                expect(retryCalled).to.be.true();
            });
        });

        describe('ç‚¹å‡»äº¤äº’', () => {
            beforeEach(() => {
                container = document.getElementById('test-container');
                container.innerHTML = '';
                selector = new TextbookSelector(container);
                selector.setDebug(false);
                selector.render(mockTextbooks);
            });

            afterEach(() => {
                if (selector) selector.destroy();
            });

            it('åº”è¯¥åœ¨ç‚¹å‡»å¡ç‰‡æ—¶é€‰æ‹©æ•™æ', () => {
                const card = container.querySelector('[data-textbook-id="english-pep-3-1"]');
                card.click();
                const selected = selector.getSelectedTextbook();
                expect(selected.id).to.equal('english-pep-3-1');
            });

            it('åº”è¯¥æ”¯æŒé”®ç›˜Enteré”®é€‰æ‹©', () => {
                const card = container.querySelector('[data-textbook-id="english-pep-3-1"]');
                const event = new KeyboardEvent('keydown', { key: 'Enter', bubbles: true });
                card.dispatchEvent(event);
                const selected = selector.getSelectedTextbook();
                expect(selected.id).to.equal('english-pep-3-1');
            });

            it('åº”è¯¥æ”¯æŒé”®ç›˜ç©ºæ ¼é”®é€‰æ‹©', () => {
                const card = container.querySelector('[data-textbook-id="english-pep-3-1"]');
                const event = new KeyboardEvent('keydown', { key: ' ', bubbles: true });
                card.dispatchEvent(event);
                const selected = selector.getSelectedTextbook();
                expect(selected.id).to.equal('english-pep-3-1');
            });
        });

        describe('æ— éšœç¢æ”¯æŒ', () => {
            beforeEach(() => {
                container = document.getElementById('test-container');
                container.innerHTML = '';
                selector = new TextbookSelector(container);
                selector.setDebug(false);
                selector.render(mockTextbooks);
            });

            afterEach(() => {
                if (selector) selector.destroy();
            });

            it('åº”è¯¥è®¾ç½®role="listbox"', () => {
                const grid = container.querySelector('.textbook-grid');
                expect(grid.getAttribute('role')).to.equal('listbox');
            });

            it('åº”è¯¥è®¾ç½®aria-label', () => {
                const grid = container.querySelector('.textbook-grid');
                expect(grid.getAttribute('aria-label')).to.equal('æ•™æé€‰æ‹©');
            });

            it('åº”è¯¥ä¸ºæ¯ä¸ªå¡ç‰‡è®¾ç½®role="option"', () => {
                const cards = container.querySelectorAll('.card-textbook');
                cards.forEach((card) => {
                    expect(card.getAttribute('role')).to.equal('option');
                });
            });

            it('åº”è¯¥ä¸ºæ¯ä¸ªå¡ç‰‡è®¾ç½®tabindex', () => {
                const cards = container.querySelectorAll('.card-textbook');
                cards.forEach((card) => {
                    expect(card.getAttribute('tabindex')).to.equal('0');
                });
            });
        });

        describe('getTextbooks', () => {
            beforeEach(() => {
                container = document.getElementById('test-container');
                container.innerHTML = '';
                selector = new TextbookSelector(container);
                selector.setDebug(false);
                selector.render(mockTextbooks);
            });

            afterEach(() => {
                if (selector) selector.destroy();
            });

            it('åº”è¯¥è¿”å›æ•™æåˆ—è¡¨çš„å‰¯æœ¬', () => {
                const textbooks = selector.getTextbooks();
                expect(textbooks).to.deep.equal(mockTextbooks);
                // ç¡®ä¿æ˜¯å‰¯æœ¬è€Œä¸æ˜¯åŸæ•°ç»„
                textbooks.push({ id: 'new' });
                expect(selector.getTextbooks().length).to.equal(3);
            });
        });

        describe('destroy', () => {
            beforeEach(() => {
                container = document.getElementById('test-container');
                container.innerHTML = '';
                selector = new TextbookSelector(container);
                selector.setDebug(false);
            });

            it('åº”è¯¥æ¸…ç©ºå®¹å™¨', () => {
                selector.render(mockTextbooks);
                selector.destroy();
                expect(container.innerHTML).to.equal('');
            });

            it('åº”è¯¥é‡ç½®æ‰€æœ‰çŠ¶æ€', () => {
                selector.render(mockTextbooks);
                selector.selectTextbook('english-pep-3-1');
                selector.destroy();
                expect(selector.getSelectedTextbook()).to.be.null();
                expect(selector.getTextbooks().length).to.equal(0);
                expect(selector.getCurrentSubjectId()).to.be.null();
            });
        });

        // ========================================
        // è¿è¡Œå¼‚æ­¥æµ‹è¯•å¹¶æ¸²æŸ“ç»“æœ
        // ========================================
        async function runAsyncTests() {
            // ç­‰å¾…æ‰€æœ‰å¼‚æ­¥æµ‹è¯•å®Œæˆ
            await new Promise(resolve => setTimeout(resolve, 500));
            renderResults();
        }

        function renderResults() {
            const container = document.getElementById('testResults');
            const summaryEl = document.getElementById('summary');
            
            // æŒ‰æµ‹è¯•å¥—ä»¶åˆ†ç»„
            const suites = {};
            testResults.forEach(result => {
                if (!suites[result.suite]) {
                    suites[result.suite] = [];
                }
                suites[result.suite].push(result);
            });

            // æ¸²æŸ“æ¯ä¸ªæµ‹è¯•å¥—ä»¶
            let html = '';
            for (const [suiteName, tests] of Object.entries(suites)) {
                html += `<div class="test-suite">
                    <h2>${suiteName}</h2>`;
                
                tests.forEach(test => {
                    const icon = test.pass ? 'âœ…' : 'âŒ';
                    const className = test.pass ? 'pass' : 'fail';
                    html += `<div class="test-case ${className}">
                        <span class="icon">${icon}</span>
                        <span>${test.name}</span>
                    </div>`;
                    if (!test.pass && test.error) {
                        html += `<div class="error-detail">${test.error}</div>`;
                    }
                });
                
                html += '</div>';
            }
            
            container.innerHTML = html;

            // æ¸²æŸ“æ‘˜è¦
            const passed = testResults.filter(r => r.pass).length;
            const failed = testResults.filter(r => !r.pass).length;
            const total = testResults.length;
            
            summaryEl.className = `summary ${failed === 0 ? 'all-pass' : 'has-fail'}`;
            summaryEl.innerHTML = `
                <strong>æµ‹è¯•ç»“æœ:</strong> ${passed}/${total} é€šè¿‡
                ${failed > 0 ? ` | ${failed} å¤±è´¥` : ' | å…¨éƒ¨é€šè¿‡ ğŸ‰'}
            `;
        }

        // è¿è¡Œæµ‹è¯•
        runAsyncTests();
    </script>
</body>
</html>
